%tr
  %td.first_name
    = health_pro.first_name
  %td.last_name
    = health_pro.last_name
  %td.date_of_birth
    = health_pro.date_of_birth
  %td.sex
    = health_pro.sex
  %td.gender
    = health_pro.sex_to_patient_gender
  %td.email
    = health_pro.email
  %td.pmi_id
    = health_pro.pmi_id
  %td.address
    = health_pro.address
  %td.status
    = health_pro.status
- if health_pro.matchable? && @batch_health_pro.ready?
  = content_tag_for(:tr, health_pro) do
    %td{ colspan: 9 }
      %ul.accordion{"data-accordion" => "", "data-allow-all-closed" => "true"}
        %li.accordion-item{"data-accordion-item" => ""}
          / Accordion tab title
          %a.accordion-title{:href => "#"} Matches?
          / Accordion tab content: it would start in the open state due to using the `is-active` state class.
          .accordion-content{"data-tab-content" => ""}
            .row
              - health_pro.matches.each do |match|
                %table.columns.large-24
                  %thead
                    %tr
                      %th{ colspan: 4 }
                        REDCap
                    %tr
                      %th.first_name
                        First
                      %th.last_name
                        Last
                      %th.email
                        Email
                      %th.match-links
                        Match?
                  %tbody
                    = content_tag_for(:tr, match) do
                      %td.first_name
                        = match.patient.first_name
                      %td.last_name
                        = match.patient.last_name
                      %td.email
                        = match.patient.email
                      %td.make-match-link.text-right
                        = form_with(model: match, url: accept_match_url(match.id), local: false, class: 'match-accept-form match-form') do |f|
                          = f.hidden_field :empi_match_id, class: 'empi_match_id'
                          = f.submit 'Accept', class: 'button', 'data-confirm': 'Accept match?'
                        = form_with(model: match, url: decline_match_url(match.id), local: false, class: 'match-decline-form match-form') do |f|
                          = f.submit 'Decline', class: 'button', 'data-confirm': 'Decline match?'
              %table.columns.large-24
                %thead
                  %tr
                    %th{ colspan: 9 }
                      EMPI
                  %tr
                    %th.first_name
                      First Name
                    %th.last_name
                      Last Name
                    %th.birth_date
                      Birth Date
                    %th.gender
                      Gender
                    %th.race
                      Race
                    %th.ethnicity
                      Ethnicity
                    %th.address
                      Address
                    %th.nmhc_mrn
                      NMHC
                    %th.assign-empi-patient-link.text-center
                      Assign?
                %tbody
                  - health_pro.empi_matches.each do |empi_match|
                    %tr.empi_match
                      %td.first_name
                        = empi_match.first_name
                      %td.last_name
                        = empi_match.last_name
                      %td.birth_date
                        = empi_match.birth_date.to_s(:date)
                      %td.gender
                        = empi_match.gender
                      %td.race
                        = empi_match.empi_race_matches.map { |empi_race_match| empi_race_match.race.name }.join("|")
                      %td.ethnicity
                        = empi_match.ethnicity
                      %td.address
                        = empi_match.address
                      %td.nmhc_mrn
                        = empi_match.nmhc_mrn
                      %td.assign-empi-match-link.text-center
                        = radio_button_tag 'assign-empi-match', empi_match.id
            .row
              .columns.large-12
                .match-create-patient-form-container
                  = render 'health_pros/match_create_patient_form', health_pro: health_pro
              .columns.large-12
                .match-create-form-container
                  = render 'health_pros/match_create_form', health_pro: health_pro, unmatched_patients: @unmatched_patients